[Lighter의 보안 가정은?]

10월 1일 퍼블릭 메인넷을 공개하고, 현재 디파이라마 7일 거래량 기준 2위에 오른 이더리움 기반 퍼프 덱스 Lighter는 어떤 구조로 이루어져 있을까요? 그리고 메커니즘적으로, 자금을 예치해도 안전할까요? 트럼프 쇼크때처럼 체인이 멈췄을 때, 내 자산을 안전하게 출금할 수 있을까요? 

지금부터 그 구조와 안전성에 대해 자세히 살펴보겠습니다.

1/ ZK 롤업 구조를 통한 보안

확장성에 치중해 상대적으로 낮은 보안을 지닌 타 퍼프덱스와 달리, Lighter는 zkSync Lite에 영감을 받은 ZK 앱체인 구조를 택했습니다. 즉, Lighter는 약 5분마다 이더리움에서 ZK 증명을 통해 무결성이 검증되는, 이더리움에 보안을 의존하는 구조로 되어 있습니다.

서싱트나 바운드리스같은 외부 증명자 네트워크에 의존할 수도 있었을 텐데, Lighter는 자체적인 증명 컨트랙트를 기반으로 직접 증명자를 운영하고 있습니다. 쉽지는 않은 일일텐데, ZK 쪽에서도 꽤 실력이 있는 팀인듯 하네요.

2/ 저렴한 L1 데이터 제출 비용

Lighter는 트랜잭션 데이터 전체를 L1에 제출하는게 아니라, 상태 차이(state diff)만 제출하여 데이터 비용을 저렴하게 유지합니다. 옵티미스틱 롤업은 누구나 챌린지를 제기할 수 있도록 하기 위해 트랜잭션 데이터가 모두 L1에 제출되어야 하지만, ZK 롤업은 상태 트리만 재구성할 수 있다면 문제가 생기는 경우에도 ZK 증명 제출이 가능하기 때문에, ZK 롤업에서 비용을 아끼기 위해 할 수 있는 좋은 선택지입니다.

실제로 Lighter는 TPS로만 보자면 베이스의 약 20배 가량의 트랜잭션을 처리하지만, L1에 제출하는 데이터는 베이스의 10% 가량밖에 되지 않습니다. 트랜잭션 데이터 전체가 아니라 상태 차이만 올리기 떄문에 효율이 훨씬 나은 것이죠.

또한 다양한 컨트랙트들이 존재하는 유니버셜 롤업보다, Lighter같이 특정 컨트랙트에서만 상태 전환이 일어나는 구조에서 상태 차이 롤업의 비용 감소 효과는 더 커진다고 볼 수 있습니다.

덕분에 Lighter는 2,000~3,000 TPS에 해당하는 많은 트랜잭션을 처리하더라도 큰 비용 증가 없이 체인을 유지할 수 있게 됩니다. 구조적으로 매우 현명한 선택이라고 보여지네요.

3/ L1 강제 포함 메커니즘

ZK 증명으로 상태 전환이 잘 되었다는 걸 보장할 수 있는 것만으로 롤업의 보안이 지켜지지는 않습니다. 예를 들어, Lighter의 시퀀서가 내 거래를 모조리 검열하거나 출금을 막으면 내 자산의 보안은 지켜지지 않는 것이나 다름없죠.

다행히 Lighter는 강제 포함 메커니즘을 구현해, 거래를 L1 컨트랙트로 강제할 수 있습니다. 만약 일정 기간 이상 시퀀서가 L1 강제 포함 트랜잭션을 검열한다면, 롤업 자체가 ‘데저트 모드’로 전환되고, 셧다운 처리가 되어 아무도 정상적인 시퀀싱을 할 수 없게 됩니다. 즉, 시퀀서는 강제 포함 트랜잭션을 포함해야 할 매우 큰 인센티브를 받게 되는 것이죠.

4/ 시퀀서가 없어도 탈출할 수 있다

위와 같이 시퀀서가 강제 포함 트랜잭션을 일정 기간 내에 포함하지 않아 시스템이 셧다운되었다고 할 때, 사용자는 탈출구(escape hatch)를 통해 자산을 언제나 출금할 수 있습니다. Lighter는 L1 블롭에 데이터를 제출하기 때문에, 이 정보를 기반으로 사용자들은 Lighter 내 본인의 잔고를 ZK로 증명하여 출금을 진행할 수 있죠.

다른 측면에서 Lighter의 보안을 살펴보면, 아직 개선해야 할 점이 많습니다. 

개선점 1: 보안 위원회

Lighter의 컨트랙트는 두 가지 방식으로 업그레이드 될 수 있습니다. 첫 번째는 단일 EOA가 21일의 딜레이를 거쳐 업그레이드를 진행하는 것이고, 두 번째는 3/5 멀티시그로 구성된 보안 위원회가 딜레이 없이 업그레이드를 하는 방식입니다. 후자의 경우 5개의 객체 중 3개만 공모한다면 악의적인 컨트랙트 업그레이드를 즉시 수행해 브릿지 자금을 훔쳐갈 수 있다는 단점이 존재하기에, 개선이 필요하죠. L2Beat에서 Lighter가 Stage 0로 마킹된 이유이기도 합니다.

개선점 2: 소스코드를 볼 수 없음

Lighter는 현재 공개된 코드가 없어, 아무나 풀노드를 운영할 수 없는 구조입니다. 또한, 비상 상황에 동작하는 검증 컨트랙트 중 하나도 이더스캔 등에서 코드를 볼 수 없는 형태이죠. ZK 롤업이라 평소엔 크게 영향이 없겠지만, 혹시나 시퀀싱에 문제가 생겨 ‘데저트 모드’로 들어가거나 했을 때 (코드가 공개된 바 없기에) 출금에 문제가 생길 수도 있겠습니다. 

위 사항에 대해 Lighter 팀도 조만간 코드 공개 및 Stage 1을 위한 계획을 발표할 것이라고 하네요. 쓰시는 분들은 위와 같은 보안 사항에 유의하여 쓰시는 것을 추천드립니다!