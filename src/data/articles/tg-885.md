아비트럼이 기본 수수료 증가로 인한 UX 저하를 막고 더 높은 확장성을 달성하기 위해 다차원 가스를 도입합니다.

1/ 배경지식 1 - 다차원 가스란 무엇인가?

다차원 가스 제안은 이더리움의 스케일링을 위해 활발히 연구되고 있는 주제입니다. 이는 현재의 단일 가스 미터링 방식을 개선해 리소스별로 별도의 가스 제한을 두자는 아이디어이죠. 

기존 이더리움에서는 하나의 가스 한도 안에서 CPU, 메모리, 스토리지, 네트워크 대역폭이 모두 경쟁하는 구조였습니다. 예를 들어, 노드가 16GB의 메모리와 10Mbps의 네트워크 대역폭을 보유하고 있더라도, 한쪽 리소스(네트워크)를 많이 쓰는 연산이 포함되면 다른 리소스(메모리)는 충분히 활용되지 못합니다. 

이는 노드가 가진 자원을 온전히 활용하지 못하게 하여, 잠재적인 확장성을 제한하는 요인이 됩니다. 다차원 가스 모델은 이러한 문제를 해결하기 위해, 각 리소스(예: CPU, 메모리, 네트워크)에 개별적인 가스 리밋을 설정함으로써 노드의 자원을 최대한 활용하고, 결과적으로 네트워크의 확장성을 높이는 것을 목표로 합니다.

2/ 배경지식 2 - 아비트럼의 가스 메커니즘

아비트럼은 이더리움과는 사뭇 다른, “백로그 기반” 가스 책정 알고리즘을 가지고 있습니다.

일반적으로 아비트럼 체인들은 초 당 7M 가스를 타겟으로 잡고, 수요를 이 수준으로 맞추기 위해 지수적인 수수료 증가 알고리즘을 도입합니다. 현재 기본 세팅값 기준의 예시를 들면, 102초 동안 가스 타겟의 2배에 해당하는 로드가 들어오면 가스비가 자연상수 e만큼인 약 2.7배 증가하는 메커니즘이죠. 아비트럼 니트로(Nitro) 스택은 블록 타임이 고정되어 있지 않고, 트랜잭션이 들어오지 않으면 블록이 생성되지 않는 메커니즘이다보니, 시간 단위의 EIP-1559와 유사한 메커니즘을 구축해둔 것입니다.

3/ 문제: 아비트럼은 획일화된 가스 책정 알고리즘 때문에, 극단적인 상황에 가스비가 매우 크게 올랐고, 사용자들의 UX가 매우 나빠졌다.

이런 가스비 증가 메커니즘은 일반적으로 L2 노드가 너무 큰 로드를 한꺼번에 받아 블록을 실행하지 못하는 상황을 방지하기 위함입니다. 구체적으로, 아비트럼이 방지하고픈 상황은 다음과 같습니다.

- 너무 큰 CPU / 메모리 리소스를 사용 (실행)

- 체인을 검증하는 노드들이 체인을 따라오기 어려움 (싱크)

- 너무 빨리 데이터베이스가 증가해서 물리적으로 노드를 실행하기 어려움 (상태 증가)

그런데 문제는, 세 가지 상황에서 요구되는 가스비 증가 속도가 다르다는 것입니다. 예를 들어, 5분 동안만 엄청난 트랜잭션 수가 쏟아지는 상황은 실행 측면에서 방지되어야 하지만, 상태 증가 측면에서는 그리 문제가 되진 않죠. 그러나 단일한 기준의 가스비 증가 메커니즘을 쓰면, 위 세 가지 항목들을 모두 반영할 수가 없습니다. 현재 아비트럼의 가스 책정 메커니즘은 매우 보수적으로 ‘가장 느린 리소스’인 ‘상태 성장’을 막는 데에 집중되어 있습니다.

이로 인해 아비트럼의 메커니즘은 EIP-1559와 동작 방식이 약간 다릅니다. 트래픽이 조금 몰릴 때 아비트럼의 가스비는 EIP-1559보다 적게 오르지만, 많이 몰릴 때는 EIP-1559보다 더 급격하게 오른다는 것이 가장 큰 차이입니다. 

이에 따라 극단적으로 트래픽이 몰릴 경우 아비트럼의 UX가 매우 크게 나빠졌습니다. 예를 들어, 아비트럼의 블록이 100초동안 꽉 찼다고 가정할 때, 최종 가스비는 22,900,000배 증가합니다. 동일 상황에서 EIP-1559의 가스 증가는 117배라는 것을 고려하면, 아비트럼은 극단적 혼잡 상황에서의 가스비 증가가 너무 빠르다는 문제를 갖고 있다고 볼 수 있습니다.

실제로 아비트럼은 작년 레이어제로 에어드랍, 지난 10월 시장 혼잡 등 여러 극단적인 상황에서 트랜잭션 수수료가 이더리움의 몇십, 몇백 배 수준으로 비싸지는 상황을 겪었습니다. 이는 모두 아비트럼의 가스 책정 메커니즘이 ‘상태 성장 방지’에 초점이 맞춰져 있기 때문입니다.

4/ 해결책 - 다차원 가스 모델

아비트럼은 이러한 상황을 다차원 가스 모델의 도입으로 해결하려고 합니다.

곧, 아비트럼은 가스 증가 요인으로 더 다양한 파라미터를 포함하게 됩니다. 이에 따라, ‘폭발적이진 않지만 수요가 지속되어 상태 증가에 안 좋은 영향을 미치는 상황’과 ‘매우 폭발적인 수요로 컴퓨팅 리소스를 한 번에 많이 써야 하는 상황’ 모두를 올바르게 컨트롤할 수 있게 되죠.

이를 도입하면, 이전처럼 아비트럼의 가스비가 롤업답지 않게 너무 증가하는 상황이 더 자주 나오지는 않을 것으로 예상됩니다. 실제로 오프체인 랩스의 시뮬레이션 결과에 따르면, 10월 10일 시장 혼잡 상황에서 이런 다차원 가스가 도입되었다면, 피크 가스비가 약 70% 감소한다고 하네요.

뿐만 아니라 아비트럼이 이 다차원 가스를 적용하면, 이더리움의 향후 업그레이드를 롤업이 선제적으로 적용하는 것이 됩니다. 이더리움에 적용될 다차원 가스와는 디테일에서 다르긴 하나, 전반적으로 글램스터담 등 이후 업그레이드에서 이더리움 코어 개발자들이 참고할 귀중한 데이터를 제공할 수 있지 않을까 싶네요. 

출처