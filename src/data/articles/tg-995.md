[프리즘 버그로 인한 샌드위치 어택]

이더리움의 지난 후사카 업그레이드는 완벽히 수행되지 못했습니다. 이더리움 합의 클라이언트인 프리즘에 버그가 있었기 때문입니다. 이로 인해, 프리즘을 사용하는 노드들은 거의 오프라인 상태가 되었으며, 이더리움 더 머지 이후 역사상 두 번째로 많은 ‘Missed slot’이 발생했죠. 이와 관련한 재미있는 리서치가 있어 공유드립니다.

이 프리즘 버그로 인해 발생했던 부작용이 있었습니다. 더 많은 유저들이 샌드위치 어택에 노출되었다는 것입니다.

일반적인 이더리움 클라이언트들은 네트워크 상황이 불안정하다고 판단하면, 자동으로 PBS 파이프라인에서 블록을 받는 것을 중단하고 퍼블릭 멤풀을 기반으로 자체적으로 블록을 만드는 로컬 블록 빌딩을 수행하는데, 이를 ’서킷 브레이커‘라고 합니다.

프리즘 버그로 인해 네트워크가 불안정해지니, 클라이언트들에서는 서킷 브레이커를 발동시켜 MEV-Boost를 쓰지 않고 로컬 블록 빌딩을 사용하게 되었고, MEV-Boost로 만든 블록의 개수가 현저히 줄어들게 되었습니다. 이렇게 되었을 때 문제는, 원래 프라이빗 멤풀을 쓰던 앱이나 월렛들이 트랜잭션 포함을 위해 퍼블릭 멤풀로 트랜잭션을 보내게 된다는 것입니다.

일반적으로 프라이빗 멤풀은 프론트러닝/샌드위치 공격을 제외한 백러닝 기회를 서처들에게 옥션으로 판매하고, 그 수익을 앱/월렛/사용자들에게 나눠주는 구조를 가지고 있습니다.

문제는 이번 버그로 인해 프라이빗 멤풀로 가던 오더플로우가 퍼블릭으로 공개되며, 트랜잭션들이 프론트러닝에 노출되었다는 것입니다. 대표적으로 메타마스크 스왑은, 이번 일로 잠시 동안 모든 트랜잭션이 퍼블릭 멤풀에 전송되었고, 총 3건의 샌드위치 공격이 발생했습니다. 다행히 변동성이 작아 피해액이 크진 않았다고 하네요.

이번 프리즘 버그에서의 문제는, 네트워크 불안정의 원인이 PBS가 아님에도 서킷 브레이커가 동작한 것이라는 점입니다. 만약 네트워크에 문제가 있을때 클라이언트가 자체적으로 문제의 원인에 대한 충분한 정보를 갖고 있다면 PBS 파이프라인을 중단할지 말지를 보다 잘 판단할 수 있다는 것입니다.

만약 글램스터담 업그레이드로 ePBS가 도입되면, 합의 클라이언트 내에서도 PTC 투표율을 통해 문제의 원인에 대한 판단이 가능해지기 때문에, 유저들이 공격을 당하는 상황이 덜 생기리라 생각되네요. ePBS에 대해 더 자세히 알고 싶으신 분들은 아래 글을 참조하시길 바랍니다(TG/Medium).

출처